<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Garbage Collector</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Garbage Collector</h1><br/><p></p><p></p><p>Параметры, с которыми была запущена программа. Это можно увидеть в VusualVM:</p><p><img src="images/11-1.png" alt="images/11-1.png" /></p><p>System.getProperties(); - sysytem properties:</p><p><img src="images/11-2.png" alt="images/11-2.png" /></p><p></p><p>Map&lt;String, String&gt; getenv = System.getenv(); - получить переменные окружения</p><p></p><p>Одна из ркеомендаций приложения 12-ти факторов:</p><p>- Приложение должно получать настройки из переменных окружения. Т.е. приложение ожидает, что ему положат в переменные окружения настройки настрйку SHOP_DB_USER:</p><p></p><p>String shop_db_user = getenv.get(&quot;SHOP_DB_USER&quot;);</p><p></p><p>----------------------------------------------------------------------------------------------------------------</p><p></p><p><span style="color:#cc7832;">import </span>java.util.ArrayList<span style="color:#cc7832;">;</span></p><p><span style="color:#cc7832;">import </span>java.util.List<span style="color:#cc7832;">;</span></p><p><span style="color:#cc7832;">import </span>java.util.Scanner<span style="color:#cc7832;">;</span></p><p><span style="color:#cc7832;"></span></p><p><span style="color:#cc7832;">public class </span>MainGarbageCollector {</p><p>    <span style="color:#cc7832;">public static void </span><span style="color:#003992;">main</span>(String[] args) {</p><p>        System.<em><span style="color:#9876aa;">out</span></em><em>.println(</em><em><span style="color:#6a8759;">&quot;- - - - Invoke GC (Garbage Collector) - - - -&quot;</span></em><em>)</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">        long </span></em><em>m1</em><em><span style="color:#cc7832;">, </span></em><em>m2</em><em><span style="color:#cc7832;">, </span></em><em>m3</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">        </span></em><em>Runtime rt = Runtime.getRuntime</em>()<span style="color:#cc7832;">; // Get a runtime instance</span></p><p><span style="color:#cc7832;">        </span>Scanner scanner = <span style="color:#cc7832;">new </span>Scanner(System.<em><span style="color:#9876aa;">in</span></em><em>)</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">        </span></em><em>String command = </em><em><span style="color:#6a8759;">&quot;c&quot;</span></em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">        while </span></em><em>(!</em><em><span style="color:#6a8759;">&quot;q&quot;</span></em><em>.equals(command)) {</em></p><p><em>            </em><em><span style="color:#cc7832;">for </span></em><em>(</em><em><span style="color:#cc7832;">int </span></em><em>i = </em><em><span style="color:#6897bb;">0</span></em><em><span style="color:#cc7832;">; </span></em><em>i &lt; </em><em><span style="color:#6897bb;">3</span></em><em><span style="color:#cc7832;">; </span></em><em>i++) {</em></p><p><em>                m1 = rt.freeMemory()</em><em><span style="color:#cc7832;">; </span></em><span style="color:#cc7832;">// Get free memory</span><em><span style="color:#cc7832;"></span></em></p><p><em><span style="color:#cc7832;">                </span></em><em>createObject</em>(<span style="color:#6897bb;">100000</span>)<span style="color:#cc7832;">; // Create some objects</span></p><p><span style="color:#cc7832;">                </span>m2 = rt.freeMemory()<span style="color:#cc7832;">; // Get free memory</span></p><p><span style="color:#cc7832;">                if </span>(<span style="color:#6a8759;">&quot;c&quot;</span>.equals(command)) {</p><p>                    System.<em>gc</em>()<span style="color:#cc7832;">;        // Invoke garbage collection</span></p><p><span style="color:#cc7832;">                </span>}</p><p>                m3 = rt.freeMemory()<span style="color:#cc7832;">; // Get free memory</span></p><p><span style="color:#cc7832;">                </span>System.<em><span style="color:#9876aa;">out</span></em><em>.println(</em><em><span style="color:#6a8759;">&quot;</span></em><em><span style="color:#cc7832;">\n</span></em><em><span style="color:#6a8759;">m1=&quot; </span></em><em>+ m1 + </em><em><span style="color:#6a8759;">&quot;  m2=&quot; </span></em><em>+ m2 + </em><em><span style="color:#6a8759;">&quot;  m3=&quot; </span></em><em>+ m3 +</em></p><p><em>                        </em><em><span style="color:#6a8759;">&quot;</span></em><em><span style="color:#cc7832;">\n</span></em><em><span style="color:#6a8759;">Memory freed by gc() = &quot; </span></em><em>+ (m3 - m2))</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">            </span></em><em>}</em></p><p><em>            System.</em><em><span style="color:#9876aa;">out</span></em><em>.print(</em><em><span style="color:#6a8759;">&quot;Enter </span></em><em><span style="color:#cc7832;">\&quot;</span></em><em><span style="color:#6a8759;">q</span></em><em><span style="color:#cc7832;">\&quot;</span></em><em><span style="color:#6a8759;"> for Quit, </span></em><em><span style="color:#cc7832;">\&quot;</span></em><em><span style="color:#6a8759;">c</span></em><em><span style="color:#cc7832;">\&quot;</span></em><em><span style="color:#6a8759;"> for Collect Garbage,&quot; </span></em><em>+</em></p><p><em>                    </em><em><span style="color:#6a8759;">&quot; and any symbol for Continue: &quot;</span></em><em>)</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">            </span></em><em>command = scanner.nextLine()</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">        </span></em><em>}</em></p><p><em>    }</em></p><p><em></em></p><p><em>    </em><em><span style="color:#cc7832;">public static void </span></em><em><span style="color:#003992;">createObject</span></em><em>(</em><em><span style="color:#cc7832;">int </span></em><em>count) {</em></p><p><em>        </em><em><span style="color:#cc7832;">for </span></em><em>(</em><em><span style="color:#cc7832;">int </span></em><em>i = </em><em><span style="color:#6897bb;">0</span></em><em><span style="color:#cc7832;">; </span></em><em>i &lt; count</em><em><span style="color:#cc7832;">; </span></em><em>i++) {</em></p><p><em>                                    // Do not store the references of new objects, so they sre</em></p><p><em>                                    // immideatelly eligible for garbage collection</em></p><p><em>            List&lt;Integer&gt; list = </em><em><span style="color:#cc7832;">new </span></em><em>ArrayList&lt;&gt;()</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">            </span></em><em>Integer object = i</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">            </span></em><em>list.add(object)</em><em><span style="color:#cc7832;">;</span></em></p><p><em><span style="color:#cc7832;">        </span></em><em>}</em></p><p><em>    }</em></p><p><em>}</em></p></div>
</body>
</html>
