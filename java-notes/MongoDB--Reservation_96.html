<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Reservation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Reservation</h1><br/><p></p><p>Резервирование.</p><p></p><p>Для создания резервной копии БД в MongoDB нам необходимо использовать команду <strong>mongodump</strong>. Данная команда “скинет” все данные нашего сервера в указанную директорию. Для ограничения количества данных существует целый ряд команд.</p><p></p><p>Пример:</p><p></p><p>Для начала запустим наш сервер:</p><p>Предположим, что наш сервер</p><p><code></code></p><p><code>sudo systemctl start mongod</code></p><p><code></code></p><p>Проверим его статус:</p><p><code></code></p><p><code>sudo service mongodb status</code></p><p><code>? mongodb.service - High-performance, schema-free document-oriented database</code></p><p><code>   Loaded: loaded (/etc/systemd/system/mongodb.service; enabled; vendor preset: enabled)</code></p><p><code>   Active: active (running) since вт 2016-11-01 08:36:44 EET; 2h 27min ago</code></p><p><code> Main PID: 1101 (mongod)</code></p><p><code>   CGroup: /system.slice/mongodb.service</code></p><p><code>           ??1101 /usr/bin/mongod --quiet --config /etc/mongod.conf</code></p><p><code></code></p><p><code>лис 01 08:36:44 proselyte systemd[1]: Started High-performance, schema-free document-oriented database</code></p><p><code></code></p><p>Примечание: данные команды выполняются не внутри mongo shell, а через терминал ОС.</p><p>Предположим, что наш сервер работает по IP 127.0.0.1 на порте 27017 и хранит все данные в директории в папке /bin/dump.</p><p>В этом случае, в результате выполнения команды mongodump мы получим следующее</p><p><code></code></p><p><code>mongodump</code></p><p><code>2016-11-01T11:13:17.433+0200	writing projectdb.developers to </code></p><p><code>2016-11-01T11:13:17.434+0200	done dumping projectdb.developers (3 documents)</code></p><p><code></code></p><p>Ниже приведён список настроек, которые могут быть указаны при создании резервной копии:</p><p> </p><p><table class="table"><tr><th>Синтаксис</th><th>Описание</th><th>Пример</th></tr><tr><td>mongodump –host ИМЯ_ХОСТА –port НОМЕР_ПОРТА</td><td>Данная команда создаст резервную копию всех БД указанного экземпляра mongod.</td><td>mongodump –host proselyte.net –port 27017</td></tr><tr><td>mongodump –dbpath ПУТЬ_К_БД –out ДИРЕКТОРИЯ_РЕЗЕРВНОЙ_КОПИИ</td><td>Данная команда создаст резервную копию указанной БД по указанному пути.</td><td>mongodump –dbpath /data/db/ –out /data/backup/</td></tr><tr><td>mongodump –collection КОЛЛЕКЦИЯ –db ИМЯ_БД</td><td>Данная команда создаст резервную копию только указанной коллекции указанной БД</td><td>mongodump –collection developers –db projectdb</td></tr></table></p><p></p><p></p><p></p><p>Восстановление данных</p><p>Для восстановления данных в MongoDB используется команда <strong>mongorestore</strong>, которая восстанавливает данные в указанную директорию.</p><p></p><p>При выполнении данной команды мы получим следующий результат:</p><p><code></code></p><p><code>mongorestore </code></p><p><code>2016-11-01T11:20:38.287+0200	using default &#39;dump&#39; directory</code></p><p><code>2016-11-01T11:20:38.287+0200	building a list of dbs and collections to restore from dump dir</code></p><p><code>2016-11-01T11:20:38.287+0200	reading metadata for projectdb.developers from dump/projectdb/developers.metadata.json</code></p><p><code>2016-11-01T11:20:38.288+0200	restoring projectdb.developers from dump/projectdb/developers.bson</code></p><p><code>2016-11-01T11:20:38.329+0200	error: multiple errors in bulk operation:</code></p><p><code>  - E11000 duplicate key error collection: projectdb.developers index: _id_ dup key: { : ObjectId(&#39;5817b36c60662ea7d39f4124&#39;) }</code></p><p><code>  - E11000 duplicate key error collection: projectdb.developers index: _id_ dup key: { : ObjectId(&#39;5817b37b60662ea7d39f4125&#39;) }</code></p><p><code>  - E11000 duplicate key error collection: projectdb.developers index: _id_ dup key: { : ObjectId(&#39;5817b38160662ea7d39f4126&#39;) }</code></p><p><code></code></p><p><code>2016-11-01T11:20:38.329+0200	restoring indexes for collection projectdb.developers from metadata</code></p><p><code>2016-11-01T11:20:38.330+0200	finished restoring projectdb.developers (3 documents)</code></p><p><code>2016-11-01T11:20:38.330+0200	done</code></p><p><code></code></p><p></p><p></p></div>
</body>
</html>
