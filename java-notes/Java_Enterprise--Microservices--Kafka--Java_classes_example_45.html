<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Java classes example</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Java classes example</h1><br/><p></p><p>==== KafkaConfiguration.java ====</p><p>package hillel.course.config;</p><p></p><p>import hillel.course.service.KafkaTopic;</p><p>import org.apache.kafka.clients.admin.NewTopic;</p><p>import org.springframework.context.annotation.Bean;</p><p>import org.springframework.context.annotation.Configuration;</p><p></p><p>@Configuration</p><p>public class KafkaConfiguration {</p><p>    @Bean</p><p>    public NewTopic topic1() {</p><p>        return new NewTopic(KafkaTopic.TOPIC1.getTopicName(), 1, (short) 1); // KafkaTopic.TOPIC1.getTopicName() - имя топика типа String</p><p>    }</p><p></p><p>    @Bean</p><p>    public NewTopic topic2() {</p><p>        return new NewTopic(KafkaTopic.TOPIC2.getTopicName(), 1, (short) 1);</p><p>    }</p><p>}</p><p>================      </p><p></p><p>==== Model.java ==== - то что мы отправляем</p><p>package hillel.course.model;</p><p></p><p>public class Message {</p><p>    private String msg;</p><p></p><p>    public Message() {</p><p>    }</p><p></p><p>    public Message(String msg) {</p><p>        this.msg = msg;</p><p>    }</p><p></p><p>    public String getMsg() {</p><p>        return msg;</p><p>    }</p><p></p><p>    public void setMsg(String msg) {</p><p>        this.msg = msg;</p><p>    }</p><p>}  </p><p>================      </p><p></p><p>==== KafkaProducer.java ==== - сервис, в который мы отправляем наше сообщение. Чтобы отправлять сообщение должен быть template типа клиента, отпрвляем в методом send()</p><p>package hillel.course.service;</p><p></p><p>import hillel.course.model.Message;</p><p>import org.slf4j.Logger;</p><p>import org.slf4j.LoggerFactory;</p><p>import org.springframework.beans.factory.annotation.Autowired;</p><p>import org.springframework.kafka.core.KafkaTemplate;</p><p>import org.springframework.stereotype.Service;</p><p></p><p>@Service</p><p>public class KafkaProducer {</p><p></p><p>    private final Logger log = LoggerFactory.getLogger(KafkaProducer.class);</p><p></p><p>    @Autowired</p><p>    private KafkaTemplate&lt;Object, Object&gt; template;</p><p></p><p>    public void send(KafkaTopic topic, String message) {</p><p>        log.info(&quot;Send message to Kafka -&gt;  &quot; + message);</p><p>        template.send(topic.getTopicName(), new Message(message));</p><p>    }</p><p>}</p><p>================      </p><p></p><p>==== KafkaConsumer.java ====</p><p>@Service</p><p>public class KafkaConsumer {</p><p></p><p>    private final Logger log = LoggerFactory.getLogger(KafkaConsumer.class);</p><p></p><p>    private static final String TOPIC_1 = &quot;topic1&quot;;</p><p></p><p>    private final ObjectMapper objectMapper = new ObjectMapper();</p><p></p><p>    @KafkaListener(id = &quot;consumer1&quot;, topics = TOPIC_1)</p><p>    public void listenTopic1(Message msg) {</p><p>        try {</p><p>            log.info(&quot;Received message from Kafka -&gt;  &quot; + objectMapper.writerFor(Message.class).writeValueAsString(msg));</p><p>        } catch (JsonProcessingException exception) {</p><p>            log.error(exception.getMessage());</p><p>        }</p><p>    }</p><p>}    </p><p>================      </p><p></p><p>==== KafkaTopic.java ====</p><p>public enum KafkaTopic {</p><p>    TOPIC1(&quot;topic1&quot;),</p><p>    TOPIC2(&quot;topic2&quot;);</p><p></p><p>    private final String topicName;</p><p></p><p>    KafkaTopic(String topicName) {</p><p>        this.topicName = topicName;</p><p>    }</p><p></p><p>    public String getTopicName() {</p><p>        return topicName;</p><p>    }</p><p>}   </p><p>================      </p><p></p><p>==== SendController.java ==== </p><p>@RestController</p><p>public class SendController {</p><p></p><p>    private final Logger log = LoggerFactory.getLogger(SendController.class);</p><p></p><p>    private final KafkaProducer kafkaProducer;</p><p></p><p>    public SendController(KafkaProducer kafkaProducer) {</p><p>        this.kafkaProducer = kafkaProducer;</p><p>    }</p><p></p><p>    @PostMapping(path = &quot;/send/toTopic1/{message}&quot;)</p><p>    public void sendMessageToTopic1(@PathVariable String message) {</p><p>        log.info(&quot;Request to send message -&gt;  &quot; + message);</p><p>        kafkaProducer.send(KafkaTopic.TOPIC1, message);</p><p>    }</p><p></p><p>    @PostMapping(path = &quot;/send/toTopic2/{message}&quot;)</p><p>    public void sendMessageToTopic2(@PathVariable String message) {</p><p>        log.info(&quot;Request to send message -&gt;  &quot; + message);</p><p>        kafkaProducer.send(KafkaTopic.TOPIC2, message);</p><p>    }</p><p>}     </p><p>================</p><p></p><p></p><p>      </p></div>
</body>
</html>
