<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Spring</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Spring</h1><br/><p>Spring - для автоматизации и упрощения рутинной работы</p><p>Spring = удобство</p><p></p><p>- IoC (inversion of control) - Spring Core, Spring Bean, Spring Context, Spring SpEl(expression language): Spring, а не разработчик, контролирует (берет на себя обязанность) когда и как он будет создавать бины, какое время будет создания этих классов, время жизни бинов</p><p>- Spring Data, JDBC, ORM (JPA), JMS, Transactions (ACID, Isolation levels)</p><p>- Aspects - профилирование (измерение метрик (производительность(кол-во пакетов, юзеров, сессий) в секундах))) - добавляется дополнительное поведение системы не изменяя ее (кроссфункциональность)</p><p>- Instrumentation - actuator (получение данных (о кол-ве запросов, бинов и т.д.)</p><p>- Web - Rest (GET, POST, PUT, PATCH, DELETE), Servlet, Portlet, WebSocket, RSocket, Socket (Rest - общение через http с сервером получением каких-то данных через Веб. Это архитектурный подход как клиент (Веб-браузер) общается с сервером)</p><p>- Cloud</p><p>- Security   </p><p> </p><p> ##### Bean scopes (scope - время жизни):</p><p></p><p>- Singleton - репозитории, контроллеры, коннекшен, утилита - все что должно быть с единой точкой входа. Все бины в Спринге по умолчанию создаются со scope=Singleton</p><p>- Prototype - каждый раз создается новая копия</p><p>- Request scope - на кажд реквест создается инстанс, выполняет какую-то работу, затем удаляется</p><p>- Session scope - живет в плане сессии - чтобы сервер помнил, что именно уэтого пользователя набор товаров в корзине и т.д.</p><p>- Application scope - чем-то похож на Singleton, он живет в рамках веб-приложения</p><p>- WebSocket scope</p><p></p><p>##### Spring annotations</p><p></p><p>        <strong>Spring core</strong></p><p>        </p><p></p><p>@Bean</p><p>public ApplicationRunner runner(Application application) {</p><p>// ............. </p><p>// ApplicationRunner либо CommandLineRunner - нужен, чтобы что-то запустить и это что-то использовало все функции Spring Boot, IoC и DI (Dependency Injection)</p><p>// Чтобы запустить в каком-то потоке консоль, и чтобы мож</p><p>}</p><p></p><p>- @Autowired (@Inject - по аналогии с @Autowired, но в чистом Java Enterprise без Спринга) - автосвязывание. Когда запускается Спринг приложение, оно просканирует все папки, найдет такой бин и автоматом его туда подставит. Автоматически создает объекты и заполняет значение этой переменной</p><p>- @Qualifier - если есть несколько бинов, которые имплементируют один и тот же интерфейс, этой аннотацией мы указываем какой бин должен быть создан аннотацией @Autowired. Если бины были созданы с помощью методов, а не с помощью @Component, то @Qualifier будет название метода:</p><p>    <div class="codebox"><pre>@Autowired<br />@Qualifier(<span style="color:#3ad900;font-weight:400">&quot;beanB1&quot;</span>) <span style="color:#0088ff;font-weight:400">//(первая буква маленькая) будет создан бин BeanB1</span><br /><span style="color:#7f0044;font-weight:400">private</span> BeanInterface dependency;</pre></div></p><p>- @Component (это тоже бин) - этой аннотацией помечается класс, если бин - это целый класс. Если Спринг Контекст его просканировал, то он сразу же этот комплнент создаст.</p><p>- @Configuration - это тоже бин. Этой аннотацией помечается класс, когда в одном классе может быть несколько бинов (методов помеченых аннотацией @Bean). Удобно объединять например: один @Configuration относится к коннекшенам, второй - к бинам отвечающим за логику, третий отвечает за проперти и т.д.</p><p>- @Bean - в памяти создастся экземпляр класса</p><p>- @MockBean - замена объекта пустой реализацией</p><p>- @MockSpy - аналогично @MockBean, но еще можно методы бина переопределить</p><p>- @Value - заполняет объект из настроек файла application.yml или application.properties</p><p>   <div class="codebox"><pre>@Value(<span style="color:#3ad900;font-weight:400">&quot;${Server.port}&quot;</span>) <span style="color:#0088ff;font-weight:400">// На языке Expression Language</span><br /><span style="color:#7f0044;font-weight:400">private</span> String serverPort;<br /><br />@Test<br /><span style="color:#7f0044;font-weight:400">public</span> <span style="color:#7f0044;font-weight:400">void</span> testServerConfig() {<br />    assertEquals(<span style="color:#3ad900;font-weight:400">&quot;9090&quot;</span>, serverPort);<br />}</pre></div></p><p>- @Service - это тоже бин. Здесь пишется бизнес логика (максимальное кол-во привил, if-ов, разветвлений). Как правило через сервисы идет работа с репозиториями.</p><p>- @Repository - для работы с базой данных</p><p>- @SpringBootApplication - класс, с которого начинается запуск приложения, включает в себя scan, с этого класса сканируются все остальные бины</p><p>- @SpringBootTest - когда запускаются тесты, запускается полноценное спринг бут приложение, чтобы тестировать все вместе с наполнением бинов и т.д. Класс тестов должен быть помечен этой аннотацией, чтобы тесты использовали весь механизм IoC (inversion of control), т.е. контекста Спринга</p><p>- @Scope - время жизни бина</p><p> <div class="codebox"><pre>    @Bean<br />    @Scope(value = ConfigurableBeanFactory.SCOPE_PROTOTYPE)<br />    <span style="color:#7f0044;font-weight:400">public</span> Counter getDefaultCounter() {<br />        <span style="color:#ff9d00;font-weight:700">return</span> <span style="color:#ff9d00;font-weight:700">new</span> Counter();<br />    }<br /><br />    @Bean<br />    @Scope(value = ConfigurableBeanFactory.SCOPE_PROTOTYPE)<br />    <span style="color:#7f0044;font-weight:400">public</span> Counter getAdjustedCounter(<span style="color:#7f0044;font-weight:400">int</span> maxNumber, <span style="color:#7f0044;font-weight:400">int</span> radix) {<br />        <span style="color:#ff9d00;font-weight:700">return</span> <span style="color:#ff9d00;font-weight:700">new</span> Counter(maxNumber, radix);<br />    }</pre></div></p><p></p><p>      </p><p>      <strong>Относится к Вебу (ендпоинтам):</strong></p><p></p><p>В Spring Web уже нет ApplicationRunner, там Web в отдельном контейнере запускается</p><p></p><p>- @Controller - Веб логика - обычно для возврата View</p><p>- @RestController - для выдачи информации в виде JSON, в виде строки, т.е. это не связано с HTML</p><p>- @RequestMapping</p><p></p><p>                      </p></div>
</body>
</html>
