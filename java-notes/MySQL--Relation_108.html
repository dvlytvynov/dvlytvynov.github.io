<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Relation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Relation</h1><br/><p></p><p>Реляционные базы данных позволяют создавать не только таблицы, но и настраивать связи между ними</p><p></p><p><strong><h2>Связь один к одному</h2></strong><h2> (одна строка из таблицы 1 соответствует только одна строка из таблицы 2)</h2></p><p></p><p>Применяется когда есть одна большая таблица, которую хотим разделить по колонкам на несколько мелких</p><p></p><p><strong>SELECT * FROM film;</strong> // полная таблица</p><p><strong>SELECT * FROM film_text;</strong> // таблица, содержащая поля только film_id, title, description</p><p></p><p>Получаем объединенную таблицу:</p><p><strong>SELECT * FROM film_text</strong></p><p><strong>JOIN film ON film_text.film_id = film.film_id;</strong> // соединяем таблицу film_text с таблицей film; ON - критерий соединения по первичному ключу (т.к. первичный ключ совпадает в обеих таблицах)</p><p><strong>SELECT film_text.title, film_text.description, film.release_year FROM film_text</strong></p><p><strong>JOIN film ON film_text.film_id = film.film_id;</strong> // то же, но воводим только 3 колонки</p><p></p><p>Update для сразу двух таблиц:</p><p><strong>UPDATE film_text, film</strong></p><p><strong>SET </strong></p><p><strong>	film_text.title = &#39;New film&#39;,</strong></p><p><strong>    film.release_year = &#39;2007&#39;</strong></p><p><strong>WHERE </strong></p><p><strong>	film_text.film_id = 1</strong></p><p><strong>	AND film.film_id = film_text.film_id;</strong></p><p>	</p><p>Удаление:</p><p><strong>DELETE FROM film, film_text</strong></p><p><strong>USING film JOIN film_text</strong></p><p><strong>WHERE film.film_id = film_text.film_id AND film.film_id = 1;</strong></p><p></p><p></p><p><strong><h2>Связь один ко многим</h2></strong><h2> (одной записи в одной таблице соответствует несколько записей в другой таблице)</h2></p><p></p><p><strong>SELECT * FROM country;</strong></p><p><strong>SELECT * FROM city;</strong></p><p></p><p>В зависимую таблицу включаем ссылку на главенствующую таблицу</p><p>В таблице городов есть колонка country_id страны, к которой город относится</p><p></p><p>Объединяем:</p><p><strong>SELECT * </strong></p><p><strong>FROM country</strong></p><p><strong>JOIN city ON country.country_id = city.country_id;</strong></p><p></p><p><strong>SELECT country.country_id, country.country, city.city_id, city.city, address.address_id, address.address</strong></p><p><strong>FROM address</strong></p><p><strong>JOIN city ON address.city_id = city.city_id</strong></p><p><strong>JOIN country ON country.country_id = city.country_id;</strong></p><p></p><p><strong><h2>Связь многие ко многим</h2></strong><h2> (записи из одной таблицы могут соответствовать множеству записей из другой таблицы и наоборот)</h2></p><p></p><p><strong>SELECT * FROM actor;</strong></p><p><strong>SELECT * FROM film;</strong></p><p></p><p>В одном фильме может сниматься множество актеров</p><p>Один актер может относиться ко множеству фильмов</p><p>Обе сущности могут существовать независимо друг от друга</p><p></p><p>Для реализации связи многие ко многим нужна третья таблица:</p><p><strong>SELECT * FROM film_actor;</strong> // здесь ссылки на таблицу actor и таблицу film: actor_id, film_id</p><p></p><p>Сводная таблица по актерам и фильмам:</p><p><strong>SELECT * </strong></p><p><strong>FROM actor</strong></p><p><strong>JOIN film_actor ON actor.actor_id = film_actor.actor_id</strong></p><p><strong>JOIN film ON film_actor.film_id = film.film_id;</strong></p><p><strong></strong></p><p><strong>SELECT actor.first_name, actor.last_name, film.title </strong></p><p><strong>FROM actor</strong></p><p><strong>JOIN film_actor ON actor.actor_id = film_actor.actor_id</strong></p><p><strong>JOIN film ON film_actor.film_id = film.film_id</strong></p><p><strong>WHERE film.film_id = 1;</strong></p><p><strong></strong></p><p><strong>SELECT actor.first_name, actor.last_name, film.title </strong></p><p><strong>FROM actor</strong></p><p><strong>JOIN film_actor ON actor.actor_id = film_actor.actor_id</strong></p><p><strong>JOIN film ON film_actor.film_id = film.film_id</strong></p><p><strong>WHERE actor.actor_id = 1;</strong></p><p></p><p></p></div>
</body>
</html>
