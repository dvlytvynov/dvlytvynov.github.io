<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Kafka</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Kafka</h1><br/><p></p><p>Один из самых популярных продуктов - Kafka.</p><p>Kafka состоит из: topic[1...n] + producer + consumer</p><p>- topic - это как общая база данных, их может быть несколько с разными ярко выраженными названиями (для чего он создается)</p><p></p><p>Kafka - следит за очередями, хранит сообщения, знает какие консюмеры прочитали сообщение. Kafka - это сервер на который мы отправляем сообщение, и откуда мы получаем сообщения.</p><p>Kafka может запуститься на нескольких компьютерах и сама синхронизировать между серверами сообщениями. При этом zookeeper следит за каждой Kafka.</p><p>zookeeper - это как надсмотрщик, управляет серверами Kafka.</p><p></p><p>==== docker-compose-for-kafka.yml ====</p><p>version: &quot;3&quot;</p><p>services:</p><p>  zookeeper:</p><p>    image: &#39;bitnami/zookeeper:latest&#39;</p><p>    ports:</p><p>      - &#39;2181:2181&#39;</p><p>    environment:</p><p>      - ALLOW_ANONYMOUS_LOGIN=yes</p><p>  kafka:</p><p>    image: &#39;bitnami/kafka:latest&#39;</p><p>    ports:</p><p>      - &#39;9092:9092&#39;</p><p>    environment:</p><p>      - KAFKA_BROKER_ID=1</p><p>      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092</p><p>      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://127.0.0.1:9092</p><p>      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181</p><p>      - ALLOW_PLAINTEXT_LISTENER=yes</p><p>    depends_on:</p><p>      - zookeeper    </p><p>================</p><p></p><p>Запускаем в командной строке:</p><p>docker-compose -f .\docker-compose-for-kafka.yml up   //   -f, --file FILE             Specify an alternate compose file</p><p>docker-compose -f .\docker-compose-for-kafka.yml down   // остановить</p><p></p><p>Конфиг для микросервиса:</p><p>==== application.yml ====</p><p>server:</p><p>  port: 9098</p><p></p><p>spring:</p><p>  kafka:</p><p>    producer:</p><p>      bootstrap-servers: localhost:9092</p><p>      value-serializer:  org.springframework.kafka.support.serializer.JsonSerializer</p><p>    consumer:</p><p>      bootstrap-servers: localhost:9092</p><p>      value-deserializer:  org.springframework.kafka.support.serializer.JsonDeserializer</p><p>      properties:</p><p>        spring:</p><p>          json:</p><p>            trusted: // доверяем этим классам:</p><p>              packages: hillel.course.* // эти классы мы можем отправлять как JSON в Kafka</p><p>    bootstrap-servers:  localhost:9092          </p><p>================</p><p></p><p>Проверяем: запускаем приложение, отправляем запрос через curl:</p><p>curl -X POST http://localhost:9098/send/toTopic1/messagemessage</p><p></p><p></p><p></p><p></p></div>
</body>
</html>
